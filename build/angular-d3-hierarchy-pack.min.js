"use strict";function hierarchyPack(){return{restrict:"AE",scope:{width:"=",height:"=",radius:"=",nodes:"="},link:function(a,b){function c(a){var b=h/a.r/2;i.domain([a.x-a.r,a.x+a.r]),j.domain([a.y-a.r,a.y+a.r]);var c=l.transition().duration(d3.event.altKey?7500:750);c.selectAll("circle").attr("cx",function(a){return i(a.x)}).attr("cy",function(a){return j(a.y)}).attr("r",function(a){return b*a.r}),c.selectAll("text").attr("x",function(a){return i(a.x)}).attr("y",function(a){return j(a.y)}).style("opacity",function(a){return b*a.r>20?1:0}),d=a,d3.event.stopPropagation()}var d,e,f=a.width,g=a.height,h=a.radius,i=d3.scale.linear().range([0,h]),j=d3.scale.linear().range([0,h]),k=d3.layout.pack().size([h,h]).value(function(a){return a.size});b.append('<div id="chart">');var l=d3.select("#chart").insert("svg:svg","h2").attr("width",f).attr("height",g).append("svg:g").attr("transform","translate("+(f-h)/2+","+(g-h)/2+")");a.$watch("nodes",function(){if(a.nodes){d=e=angular.copy(a.nodes);var b=k.nodes(e);l.selectAll("circle").data(b).enter().append("svg:circle").attr("class",function(a){return a.children?"parent":"child"}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",function(a){return a.r}).on("click",function(a){return c(d==a?e:a)}),l.selectAll("text").data(b).enter().append("svg:text").attr("class",function(a){return a.children?"parent":"child"}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(a){return a.r>20?1:0}).text(function(a){return a.name}),d3.select(window).on("click",function(){c(e)})}},!0)}}}var app=angular.module("renderteam.hierarchyPack",[]);app.directive("hierarchyPack",hierarchyPack),hierarchyPack.$inject=[];