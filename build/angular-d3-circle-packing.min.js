"use strict";function circlePacking(){return{restrict:"E",scope:{width:"=",height:"=",radius:"=",nodes:"="},link:function(a){function b(a){var b=g/a.r/2;h.domain([a.x-a.r,a.x+a.r]),i.domain([a.y-a.r,a.y+a.r]);var d=k.transition().duration(d3.event.altKey?7500:750);d.selectAll("circle").attr("cx",function(a){return h(a.x)}).attr("cy",function(a){return i(a.y)}).attr("r",function(a){return b*a.r}),console.log(a),d.selectAll("text").attr("x",function(a){return h(a.x)}).attr("y",function(a){return i(a.y)}).style("opacity",function(b){return b.depth===a.depth+1?1:0}),c=a,d3.event.stopPropagation()}var c,d,e=a.width,f=a.height,g=a.radius,h=d3.scale.linear().range([0,g]),i=d3.scale.linear().range([0,g]),j=d3.layout.pack().size([g,g]).value(function(a){return a.size}),k=d3.select("circle-packing").insert("svg:svg","h2").attr("width",e).attr("height",f).append("svg:g").attr("transform","translate("+(e-g)/2+","+(f-g)/2+")");a.$watch("nodes",function(){if(a.nodes){c=d=angular.copy(a.nodes);var e=j.nodes(d);k.selectAll("circle").data(e).enter().append("svg:circle").attr("class",function(a){return a.children?"parent":"child"}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",function(a){return a.r}).on("click",function(a){return b(c===a?d:a)}),k.selectAll("text").data(e).enter().append("svg:text").attr("class",function(a){return a.children?"parent":"child"}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(a){return a.r>20?1:0}).text(function(a){return a.name}),d3.select(window).on("click",function(){b(d)})}},!0)}}}var app=angular.module("renderteam.circlePacking",[]);app.directive("circlePacking",circlePacking),circlePacking.$inject=[];